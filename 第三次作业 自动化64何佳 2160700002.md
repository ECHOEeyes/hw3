**数字图像处理**

**第三次作业**

姓名：何佳

班级：自动化64

学号：2160700002

提交日期：2019.3.18

**摘要：**本次作业以数字图像的直方图处理为主题，先后完成了以下5个任务：①读取图像并绘制相应灰度直方图；②对图像进行直方图均衡并和源图像进行比对，分析改善内容；③把图像按照对源图像直方图的观察，指定不同源图像的直方图，进行直方图匹配增强；④对图像（以elain和lena图像为例）进行7\*7的局部直方图增强；⑤利用直方图进行图像分割（以elain和woman图像为例）。

以上的任务均得到良好的结果。

#### 画出图像直方图

1.1 直方图概念

直方图（主要指图像灰度直方图），是多种空间域处理技术的基础。灰度级范围为[0,L-1]的数字图像的直方图是离散函数h(rk)=nk，其中rk是第k级灰度值，nk是图像中灰度为rk的像素个数。
在实践中，经常用乘积MN表示的图像像素的总数除它的每个分量来归一化直方图，通常M和N是图像的行和列的维数。因此，归一化后的直方图由P(rk)=nk
/MN给出，其中k=0,
1,…，L-1。简单地说，p(rk)是灰度级在图像中出现的概率的一个估计。归一化直方图的所有分量之和应等于1。

1.2 索引图像转为灰度图像

利用ind2gray()可以将索引图像转换成灰度图像。I=ind2gray(X,map);将具有颜色映射表map的索引图转换成灰度图像，去除了索引图像的颜色、饱和度信息，保留了图像的亮度信息。输入图像的类型可以是double、uint8,但输出为double。

1.3 编程实现

1）MATLAB中绘制图像灰度直方图可采用imhist()函数：

h=imhist(img,b);

其中:img是输入图像，b是容器（简单说就是分几块显示），若为为256灰度级则设为2562。若要得到归一化后的图像，可利用：

h_normal=imhist(img,b)/numel(img);

其中numel(img)是求出所有灰度级数量总和，即图像总像素数。

2）手动实现方法：

首先将索引图像转为灰度图像，然后逐像素对图像进行处理，即对一幅灰度图像从上到下，从左到右扫描每个像素值，在每个灰度值上计算像素数目，以这些数据为基础通过直方图定义完成图像直方图的绘制。

1.4 结果分析与讨论

1）citywall图像

![](media/fcb507a22aac9ded08fb7b7c9ade3b48.png)

![](media/6171d2ce371efe85e776b1eec4f1a5a7.png)

![](media/4433b069682845885e471d11a0dba43b.tmp)

![](media/f6bc2a192ea15a88eaecb01dd1d5518f.tmp)

![](media/de59ee9ab0d7446198c47f3891515e4c.tmp)

![](media/43da4b8f60baafd8f1dcb1cf3abb5da6.tmp)

2）elain图像

![](media/ce4398a79c003d0c56ea91188cf80a84.png)

![](media/22b384ffca55e07d4fa91b58dee04629.png)

![](media/7c34e64b44180db802be5c0c7eb9d263.tmp)

![](media/b470707f4538cef6f4bb764c764987ee.tmp)

![](media/26e6242541e842c6e8d3e581739f03d7.png)

![](media/139f965857fdb3b2b0ae80e8301dd320.tmp)

![](media/219c3512c152bd57c6bdb215d24235fb.png)

![](media/0f41829900a95ab8fdbc8eaa3fc978e5.png)

3）lena图像

![](media/cf0806eb3bd82bf8042abc8b7aa6b082.png)

![](media/5f76760ee677eafe24c0e9846b0d3f64.png)

![](media/15f17925751be787778802737a3d4e3d.png)

![](media/e3ac43b12bd5868c11bdc5930f438941.png)

![](media/4586f83a5064b66613ad529f6a61e971.tmp)

![](media/432038cdc62f4bcdb6051188a0aba54d.png)

![](media/9c09593b336561cfced96db44e2d72eb.tmp)

![](media/50669b9804ed437c1da41f0781111e45.tmp)

4）woman图像

![](media/e146d042de0c3e63e469ef31132c49e3.png)

![](media/10b6ef988d1f4ea2a6b33e8454b17169.png)

![](media/d0e62c75c0ed2829bd2623f413f8c06c.tmp)

![](media/4e13a0f656450997e8288d4d4a36372b.tmp)

![](media/633bc02bb0ccafd40be5f70a6f4f9d7f.tmp)

![](media/46b5f95c611cabb2f9f27d17cb01fd45.png)

本文分别采用imhist函数和自已编写的程序求取图像的直方图。从实验结果中看出图像直方图对于原始图像是基本一致的，验证了自已编写的程序的正确性。但imhist函数并没有将统计的灰度值出现的次数进行归一化处理，因此纵坐标值略有不同。

将直方图与原始图像对比可以清楚的看到图像的灰度分布与图像直方图之间的关系:
在图像处理的过程中，我们注意到：

（1）在暗的图像中，直方图的灰度量集中在灰度级比较低（灰度值比较小）的那一端。如图
a 所示。

（2）在亮的图像中，直方图的灰度量集中在灰度级比较高（灰度值比较大）的那一端。如图
b 所示。

（3）在低对比度的图像中，直方图的灰度量具有较窄的范围，并且集中在灰度级的中部，如图
c 所示。

（4） 在高对比度的图像中，直方图的灰度量具有较宽的范围，并且像素分布比较均匀。

#### 直方图均衡

2.1问题分析

直方图均衡化是图像处理领域中利用图像直方图对对比度进行调整的方法。这种方法通常用来增加许多图像的局部对比度，尤其是当图像的有用数据的对比度相当接近的时候。通过这种方法，亮度可以更好地在直方图上分布。这样就可以用于增强局部的对比度而不影响整体的对比度，直方图均衡化通过有效地扩展常用的亮度来实现这种功能。

直方图均衡化处理的“中心思想”是把原始图像的灰度直方图从比较集中的某个灰度区间变成在全部灰度范围内的均匀分布。直方图均衡化就是对图像进行非线性拉伸，重新分配图像像素值，使一定灰度范围内的像素数量大致相同。直方图均衡化就是寻找一个变换函数实现输出图像的灰度值能够在整个范围内均匀分布。

直方图均衡化的过程:

1)列出原始图像和变换后图像的灰度级(L是灰度级的个数) ;

2)统计原图像中各灰度级的像素个数；

3)计算原始图像直方图P(i)=Ni/N;

4)计算累计直方图P()=P(1) + P(2) + P(3)+…+ P(i)

5)利用灰度值变换函数计算变换后的灰度值，并四舍五入取整; j=INT[(L-1)Pj+0.5]

6)确定灰度变换关系i→j，据此将原图像的灰度值f (m,n) =i 修正为g (m，n) =j;

7)统计变换后个灰度级的像素个数Nj;8)计算变换后图像的直方图Pj=NjN;

2.2 编程实现

以下是相关的matlab函数:

J =histeq(I hgram)

>   将原始图像I的直方图变成用户指定的向量hgram。hgram 中的各元素的值域为[0,1]。J
>   = histeq(I,n)

指定直方图均衡后的灰度级数n,默认值为64。

[J,T] = histeq(I,.....)

返回从能将图像I的灰度直方图变换成图像J的直方图变换T。

2.3处理结果

1）citywall图像

![](media/950bed68fe39c89cf596032a661a57c2.tmp)

![](media/e9b7ac18de60fb2e99772a63323be2b2.tmp)

![](media/d4664e7dfc6561ebbc289fea2eb68cee.tmp)

2）elain图像

![](media/c3259b419c731076a10d2213b83738da.tmp)

![](media/42b6cd23c8f689d594bb5d588d972fda.tmp)

![](media/5221ab19c0771e2eff8ce98b17d3e53b.tmp)

![](media/37a853f1e431c5ee33c3488a9a4d8877.tmp)

3）lena图像

![](media/17b8e75ccbf899053cd6fb35e0819302.tmp)

![](media/567b238a6a1808fd45a3fbe78083bf3f.tmp)

![](media/4d414f78b3062f7f7e0244bd955d5d83.tmp)

![](media/aa4d73bd609f3e95a4afe2d1962066f4.tmp)

4）woman图像

![](media/06d73c7612b4b4e5f55f3196fb995dee.tmp)

![](media/fa8c86828f5f85b3c9f61a0b9e0d2bea.tmp)

![](media/c997c298f9c43ff28dd275523c9c4959.tmp)

2.4结果分析与讨论

经过处理得到若干组每组四幅图像，每组中四幅图像分别为原始图像、直方图均衡化后的图像、原始图像的直方图以及均衡化后图像的直方图。从直方图上可以观察到灰度分布确实更加均匀并且占据整个灰度级范围;从图像上可以观察到，图像对比的变大，灰度色调变化范围加大。同时，也注意到有些图像的均衡效果不是很好。直方图均衡并不是适用于所有的图像，需要分情况处理。直观上，可以得出这样的结论：若一幅图像的像素倾向于占据整个可能的灰度级并且分布均匀,则该图像会有高对比度的外观并展示灰色调的较大变化。最终效果将是一幅灰度细节丰富且动态范围较大的图像。

#### 通过直方图匹配对图像进行增强

3.1 直方图匹配概念

与直方图均衡不同的一点是，直方图匹配要得到的是具有特定形状的直方图的图像。当图像中接近0的像素过多，进行直方图均衡的时候，会导致统计概率变大，直接映射到高灰度，直接导致图像整体变量，达不到原来想要的结果，此时就需要使用直方图匹配，让变化后的图像具有特定的直方图。有时候，我们为了使两幅图像的色调保持一致，也可以采用该方法。

直方图匹配的计算过程如下：

1. 根据以下公式（直方图均衡时用到的公式）计算输入图像的s = T(r)

![https://img-blog.csdn.net/20180131160459381?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2pzaF8xMjM0NTY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast](media/4a605fa45fedb211961ca094661570f7.png)

2. 根据相同的公式计算模板直方图的 G(z)，p(z)为模板直方图的pdf。

![https://img-blog.csdn.net/20180131160706582?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2pzaF8xMjM0NTY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast](media/49eb257f3854355c8ca61eb6db85de08.png)

3. 令G(z) = T(r)，求出r→z，当不止一个z满足时，通常选择最小的值。

注意：a. 对于灰度级为L，取值为[0,
L-1]的灰度直方图，在计算T(r)和G(z)的过程中要四舍五入。 b.
由于对G(z)和T(r)进行了四舍五入，因此求r对应的z时，有可能有多个z满足要求，一般选择z最小的值。

r→z的求解：r→z表示对于一个r(对于L =
256的灰度直方图，r取0,1,2,...,254,255)，找出满足T(r) =
G(z)的z，若不存在，则找出最接近的z（即找出min(abs( T(r) - G(z) )
对应的z）。前面已经说了，当z有多个时，通常取最小的。（若不考虑只取整数的情况，则当p(r)和p(z)处处不为0时，仅有一个z与r对应）

3.2 编程实现

![](media/4fd0b20ede14bf9b62b39d07a6543bd0.tmp)

3.3处理结果

1）citywall图像

![](media/90f5253c679c97afd9139e75f095e5ae.tmp)

![](media/ef40845bc94bc66eea66548321925797.tmp)

2）elain图像

![](media/123bfaab94035a7028961f38f7e7638b.tmp)

![](media/0146a40d6d18876fac6bcd51feb46aeb.tmp)

![](media/63352b1d217f79fe87da98fd3bf022cd.tmp)

3）lena图像

![](media/d8e8dc3c78e4f29dff7faef540c12d87.tmp)

![](media/36d14bc1af9a7d7654ea818880c4504f.tmp)

![](media/69ac08c3e5146163f739d61933cad613.tmp)

4）woman图像

![](media/30de21717aa308136bf0c80d09125943.tmp)

![](media/75090fb0ec729b8f1ebdfa6c97efa508.tmp)

3.4结果分析与讨论

对比原始图像的直方图、匹配图的直方图以及增强后图像的直方图可知，程序基本达到了直方图匹配的要求。但也注意到:原始图像直方图和匹配后图像的直方图并没有完全一致。分析原因：原因一：离散量的舍入误差；原因二原始图像中多个灰度值映射到增强后图像的同一个灰度值，即多对一的映射导致。对比原始图像以及增强后的图像可知，经过直方图后，大部分图像的效果得到了一定的改善。但也注意到有些图像的效果非但没有改善反而变差了，可能是因为要求匹配的直方图选择不合适导致的或者是要求进行直方图匹配的图像的直方图灰度值分布过于集中。

#### 对elain和lena图像进行7\*7的局部直方图增强

4.1 问题分析：

局部直方图的思想在于并非对整个图像采用直方图算法，而是改变目标为针对像素点的邻域。该过程是定义一个邻域，并把该区域的中心从一个像素移至另一个像素。在每一个位置，计算邻域中的点的直方图，并且得到的不是直方图均衡化，就是规定化变换函数。这个函数最终用于映射邻域中心像素的灰度。然后，邻域中心的被移至一个相邻像素位置，并重复该过程。当邻域进行逐像素平移时，由于只有邻域中的一行或一列改变，所以可在每一步移动中，以新数据更新前一个位置得到的直方图。这种方法与区域每移动一个像素位置就计算邻域中所有像素的直方图相比有明显的优点。

局部直方图增强的步骤如下：

![https://img-blog.csdn.net/20180407200644129](media/41a0ff2f59bb24d95d40928948614143.jpg)

4.2处理结果

1）lena图像

![](media/fe561297c2f18af44e403d65cb96c7cf.png)

![](media/052219e8aa605c54ecf008c83ffc6f70.tmp)

![](media/d934544b1ae9458ac4855157f572e779.tmp)

2）elain图像

![](media/ddffc4093d6bcdba30f7423c84a0b79f.tmp)

![](media/ede1da208c24f3cf294efb62a0cb5566.tmp)

![](media/b6a7e0e43f1f192e3b80073592942426.tmp)

4.3 结果分析与讨论

通过局部直方图增强，当图像中的灰度暗于一定阈值时对其进行增强处理，高于阈值的部分不变，从图中对比得，lena、elain的头发、帽檐等处的细节变多。

五、利用直方图对图像elain和woman进行分割
----------------------------------------

5.1 直方图分割概念

直方图分割的阈值方法的原理是，如果图像所包括的背景区域与所分的目标区域大小可比，而且两者在灰度上有着明显的去表，那么这样的图像的灰度上有着明显的去表，那么这样的图像的灰度直方图就会呈现很明显的双峰状;其中一个峰值对应的应该是背景区域的灰度;而另一个峰值对应的就是目标灰度了;理想中的图像的灰度直方图，其背景灰度和目标灰度应对应两个不同过的灰度峰值，所以选取位于两峰之间的谷值作为阀值，就很快地将一副图像的背景与目标分割开了。经典的直方图算法实现简单，但是这只是针对少数不同类别的物体彼此灰度相差很大时，才能进行有效的分割。当原始图像的双峰不明显时，分割得不到理想的图像。

5.2 编程实现

![](media/b21e11203594ea7a9433bbba45b72b8a.tmp)

5.3 处理结果

1）elain图像

![](media/285841262d317136826afce1e8b536a4.tmp)

2）woman图像

![](media/f5ed8b830b88432d4063b69771531222.tmp)

5.4 结果分析与讨论

上述对elain人工阈值分割采用140为阈值，对woman人工阈值分割采用120为阈值，均与matlab自带函数分割差别不大，但也存在细微差别。从结果来看，自动Otus阈值分割效果良好。

参考文献

https://blog.csdn.net/zxc024000/article/details/49130605

http://blog.sina.com.cn/s/blog_9a924c970101el7d.html

https://blog.csdn.net/zxc024000/article/details/49130605

https://blog.csdn.net/u013355826/article/details/57417771

https://blog.csdn.net/cjsh_123456/article/details/79218179

https://blog.csdn.net/IMWTJ123/article/details/79844344

https://blog.csdn.net/qq_33414271/article/details/78521027
